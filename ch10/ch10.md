
## Ch10. 애노테이션과 리플렉션 

애노테이션과 리플렉션을 사용하면 클래스 이름, 함수 이름, 파라미터 명을 명시하는 제약에서 벗어나   
미리 알고있지 않은 임의의 클래스를 다룰 수 있음.

- 애노테이션 -> 라이브러리가 요구하는 의미를 클래스에게 부여할 수 있음
- 리플렉션 -> 런타임시점에 컴파일러 내부 구조를 분석할 수 있음

### 애노테이션 선언과 적용
- 메타데이터를 선언에 추가하면, 애노테이션을 처리하는 도구가 컴파일 시점이나 실행 시점에 적절한 처리를 해줌

#### 애노테이션 적용
- 선언 시 함수나 클래스 이름 앞에 [@ + 애노테이션 이름] 넣으면 됨.
- 에노테이션에 인자를 넘길 때는 일반 함수와 마찬가지로 괄호 안에 인자 넣음.
  - 인자에는 원시 타입의 값, 문자열, enum, 클래스 참조, 다른 애노테이션 클래스, 그리고 지금까지 말한 요소들로 이뤄진 배열이 들어갈 수 있음
  - 클래스를 애노테이션 인자로 지정할 때: @MyAnnotation(MyClass::class)처럼 ::class를 클래스 이름 뒤에 뒤에 넣어야 함.
  - 다른 애노테이션을 인자로 지정할 때: 인자로 들어가는 애노테이션의 이름 앞에 @를 넣지 않아야 한다.
  - 배열을 인자로 지정할 때: @RequestMapping(path = arrayOf("/foo", "/bar"))처럼 arrayOf 함수를 사용한다. 하지만 자바에서 선언한 애노테이션 클래스를 사용하는 경우라면 value라는 이름의 파라미터가 자동으로 가변 길이 인자로 변환되게 된다. 따라서 이 경우에는 arrayOf 함수를 쓰지 않아도 된다.

- 애노테이션 인자는 컴파일 시점에 인지 가능해야 하므로 임의의 프로퍼티를 인자로 지정할 수는 없다. 
  - 프로퍼티를 애노테이션 인자로 사용하려면 그 앞에 const 변경자를 붙여야 한다.

#### 애노테이션 대상
- 사용 지점 대상 선언으로 애노테이션을 붙일 요소를 정할 수 있음.
- @get:Rule
- @get -> 사용지점대상
- Rule -> 애노테이션 이름

#### 애노테이션 선언
```kotlin
annotation class JsonExclude //파라미터를 가지지 않을 때
annotation class JsonName(val name: String) //파라미터 명시

/* 자바 */
public @interface JsonName {
  String value();
}

```

#### 메타 애노테이션: 애노테이션을 처리하는 방법 제어
- 애노테이션 클래스에 적용할 수 있는 애노테이션을 메타애노테이션이라고 부른다.
- 표준 라이브러리에서 가장 흔하게 사용되는 메타-애노테이션은 @Target이다.



#### 애노테이션 파라미터로 클래스 활용
- 클래스 참조를 파라미터로 가지는 애노테이션 클래스를 만들 수도 있음. 


#### 리플랙션: 실행 시점에 코틀린 객체 내부 관찰
- 런타임에 동적으로 객체의 프로퍼티와 메서드에 접근할 수 있게 해주는 방법.
- 코틀린에서 리플렉션을 사용하려면 두 가지 서로 다른 리플렉션 API를 다룰 줄 알아야 함. 
  - 첫 번째는 자바가 java.lang.reflect 패키지를 통해 제공하는 표준 리플렉션이다. 
    - 코틀린 클래스는 일반 자바 바이트코드로 컴파일되므로 자바 리플렉션 API도 코틀린 클래스를 컴파일한 바이트코드를 완벽히 지원함.
  - 두 번째 API는 코틀린이 kotlin.reflect 패키지를 통해 제공하는 코틀린 리플렉션 API. 
    - 이 API는 자바에는 없는 프로퍼티나 nullable 타입과 같은 코틀린 고유 개념에 대한 리플렉션을 제공한다.
    
    

#### 코틀린 리플렉션 API: KClass, KCallable, KFunction, KProperty
- KClass
  - java.lang.Class에 해당하는 것으로, 클래스를 표현하는 역할을 한다.
  - 모든 선언 열거, 상위 클래스 얻기 등의 작업이 가능하다.
- KCallable
  - 함수, 프로퍼티의 공통 상위 인터페이스다.
  - call 인터페이스를 제공해 가변 인자와 가변 반환을 할 수 있다.

- KFunction
  - 함수를 표현하는 역할을 한다.
  - invoke 함수를 제공해서 컴파일 타임에 인자 개수와 타입에 대한 체크를 할 수 있다.
  - KFunction1<Int, Unit>의 형식으로 반환 값 타입 정보를 넣어 활용이 가능하다.

- KProperty
  - 프로퍼티를 표현한다. (단, 함수의 로컬 변수에는 접근할 수 없다)
  - get 함수를 제공해서 프로퍼티 값을 얻을 수 있다.

